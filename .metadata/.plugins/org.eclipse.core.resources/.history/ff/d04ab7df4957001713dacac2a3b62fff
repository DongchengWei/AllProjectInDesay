/**
 * @Author：Tonsen
 * @Email ：Dongcheng.Wei@desay-svautomotive.com
 * @Date  ：2017-06-22
 */
package com.update;

import com.android.uiautomator.core.UiDevice;
import com.android.uiautomator.core.UiObjectNotFoundException;
import com.android.uiautomator.testrunner.UiAutomatorTestCase;
import com.otherutils.Utils;
import com.pageutil.HomePage;
import com.pageutil.SettingsPage;
import com.pageutil.SysTabPage;
import com.pageutil.UpdatePage;
import com.runutils.RunTestCase;

import android.os.RemoteException;

/** 
* @author 作者 E-mail: Dongcheng.Wei@desay-svautomotive.com
* @version 创建时间：2017年6月22日 下午8:38:30 
* 类说明 :
*/
/**
 * @author uidq0460
 *
 */
public class UpdateVersion extends UiAutomatorTestCase {

	/**
	 * 
	 * @param args
	 * @Date 2017-06-22
	 */
	public static void main(String[] args) {
		// TODO Auto-generated method stub
		RunTestCase runTestCase=new RunTestCase("AutoTest",  
				 "com.update.UpdateVersion", "", "3");  
		runTestCase.setDebug(false);  
		runTestCase.runUiautomator(); 
	}
	//输出版本信息
	public static void CaseInfo(){
		System.out.println("==================================================");
		System.out.println("=========G5Android AutoTest v0.0.1================");
		System.out.println("========case:Update to new Version================");
		System.out.println("==================================================");
	}
	public void testUpdateVersion() {
		try {
			UiDevice.getInstance().wakeUp();
			Utils.stopRunningWatcher();
			
			assertEquals(true, continusUpdateTest());
			
			updateToNewVersion();
		} catch (RemoteException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
	}
	public boolean updateToNewVersion() {
		boolean isOk = false;
		
		UpdatePage updatePage = new UpdatePage();
		HomePage homePage = new HomePage();
		SettingsPage settingsPage = new SettingsPage();
		SysTabPage sysTabPage = new SysTabPage();
		try {
			homePage.goBackHome();
			homePage.intoSettings();
			if (homePage.intoSettings()) {//进入设置
				if (settingsPage.intoSystemTab()) {//系统
					if (sysTabPage.intoSystemUpdatePage()) {//进入系统升级，会弹出升级成功对话框
						updatePage.clickConfirmUpdateOk();//确定
						if (updatePage.clickCheckUpdateBtn()) {//点击检查升级按钮
							if (updatePage.clickConfirmToUpdate()) {//确定升级
								if (updatePage.clickConfirmIfDialogExists(5000)) {//弹出确定框
									if (updatePage.clickUpdateNow()) {//立即升级
										Utils.logPrint("update now...");
//										if (updatePage.clickConfirmIfDialogExists(5000)) {//确定
//											isOk = true;
//											Utils.logForResult("updating ...");
//										} else {
//											Utils.logPrint("confirm update now fail...");
//										}
									} else {
										Utils.logPrint("update now fail...");
									}
								} else {
									Utils.logPrint("updating1 fail...");
								}
							} else {
								Utils.logPrint("updating fail...");
							}
						} else {
							Utils.logPrint("check updating fail...");
						}
					} else {
						Utils.logPrint("into system update fail...");
					}
				} else {
					Utils.logPrint("intoSystemTab fail...");
				}
			} else {
				Utils.logPrint("intoSettings fail...");
			}
		} catch (UiObjectNotFoundException e) {
			Utils.logPrint("UiObjectNotFoundException:" + e.toString());
		}
		
		return isOk;
	}

}
